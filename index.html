<!DOCTYPE html>
<html>
<head>
    <title>Mi Reproductor</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial; margin: 10px; }
        input, select { width: 100%; padding: 8px; margin-bottom: 8px; font-size: 16px; }
        button { padding: 10px; width: 100%; font-size: 16px; }
        pre { background: #f0f0f0; padding: 10px; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Crear Reproductor</h1>
    <input type="text" id="embedInput" placeholder="Enlace embed (ej. https://filemoon.sx/e/video-id)" required>
    <input type="text" id="titleInput" placeholder="Título película/serie (ej. The Matrix)" required>
    <input type="text" id="episodeInput" placeholder="Temporada/Episodio (ej. S1E1, opcional)">
    <label for="adsType">Anuncios:</label>
    <select id="adsType">
        <option value="propios">Mis Anuncios</option>
        <option value="externos">Anuncios Externos</option>
    </select>
    <button onclick="generarEmbed()">Generar</button>
    <div id="status"></div>
    <pre id="embedCode" style="display:none;"></pre>

    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDCE1cl562Vud48wvHxTSpDWgQgMDJ2RkQ",
  authDomain: "mi-servicio-e7aaf.firebaseapp.com",
  projectId: "mi-servicio-e7aaf",
  storageBucket: "mi-servicio-e7aaf.firebasestorage.app",
  messagingSenderId: "1034936521708",
  appId: "1:1034936521708:web:b9833d09acc3ac7e1666c9",
  measurementId: "G-K041328HX9"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function generarEmbed() {
            const embedUrl = document.getElementById('embedInput').value;
            const title = document.getElementById('titleInput').value;
            const episode = document.getElementById('episodeInput').value;
            const adsType = document.getElementById('adsType').value;
            if (!embedUrl || !title) return alert('Falta enlace o título');

            const tmdbApiKey = 'TU_TMDB_API_KEY';  // Reemplaza
            const searchType = episode ? 'tv' : 'movie';
            const query = encodeURIComponent(title + (episode ? ' ' + episode : ''));
            let tmdbId = null, poster = '', description = '';
            try {
                const response = await fetch(`https://api.themoviedb.org/3/search/${searchType}?api_key=${tmdbApiKey}&query=${query}`);
                const data = await response.json();
                tmdbId = data.results[0]?.id || null;
                poster = data.results[0]?.poster_path ? `https://image.tmdb.org/t/p/w500${data.results[0].poster_path}` : '';
                description = data.results[0]?.overview || '';
            } catch (e) {
                console.log('TMDB error:', e);
            }

            await db.collection('videos').add({
                embedUrl: embedUrl,
                title: title,
                title_lowercase: title.toLowerCase(),
                episode: episode,
                tmdbId: tmdbId,
                poster: poster,
                description: description,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            const playerUrl = `https://angelfelipmins-debug.github.io/My-vids/player.html?embed=${encodeURIComponent(embedUrl)}&ads_type=${adsType}&title=${encodeURIComponent(title)}&episode=${encodeURIComponent(episode)}&poster=${encodeURIComponent(poster)}&desc=${encodeURIComponent(description)}`;
            document.getElementById('status').innerHTML = `<p>URL: <a href="${playerUrl}" target="_blank">${playerUrl}</a></p>`;
            document.getElementById('embedCode').style.display = 'block';
            document.getElementById('embedCode').innerHTML = `Iframe: <iframe src="${playerUrl}" width="100%" height="360" frameborder="0" allowfullscreen></iframe>`;
        }
    </script>
</body>
</html>
